<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="/css_5_user_panel/edit_profile.css">
    <link rel="stylesheet" href="/css_5_user_panel/style_aside_bar.css">
    <link rel="stylesheet" href="/css_5_user_panel/user_panel_background.css">
    <style>
        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .form-group label {
            flex: 1;
        }
        .form-group input {
            flex: 2;
            margin-right: 10px;
        }
        .form-group button {
            flex: 1;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <aside class="sidebar hidden" id="sidebar">
        <a href="/user-panel/user_pages/abonamenteactive.html" class="sidebar-btn">Abonamente active</a>
        <a href="/user-panel/user_pages/istoricabonamente.html" class="sidebar-btn">Istoric</a>
        <a href="/user-panel/user_pages/setariclienti.html" class="sidebar-btn">Setari</a>
    </aside>

    <div class="arrow" id="toggle-arrow">ðŸš‡</div>

    <main class="main-content">
        <h2>Edit Your Profile</h2>

        <div id="profile-info">
            <div class="form-group">
                <label for="first-name">First Name:</label>
                <input type="text" id="first-name" name="first_name" pattern="[A-Za-z]+" title="Please enter a valid first name"  required>
            </div>

            <div class="form-group">
                <label for="last-name">Last Name:</label>
                <input type="text" id="last-name" name="last_name" pattern="[A-Za-z]+" title="Please enter a valid last name" required>
            </div>
            
            <div class="form-group">
                <label for="cnp">CNP:</label>
                <input type="text" id="cnp" name="cnp" pattern="\d{13}" title="CNP must be 13 digits long" required>
                <div class="error-message">CNP cannot be changed. If you encounter any issues, please contact us via email.</div>
            </div>
            
            <div class="form-group">
                <label for="bdate">Date of Birth:</label>
                <input type="date" id="bdate" name="bdate" required>
                <div class="error-message">Date of Birth cannot be changed. If you encounter any issues, please contact us via email.</div>
            </div>
            
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" pattern="[a-zA-Z0-9._]+@(yahoo\.com|gmail\.com|outlook\.com)" title="Please enter a valid email address" required>
            </div>

            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{7,}" title="Password must be at least 7 characters long, include at least one uppercase letter, one lowercase letter, one number, and one special character."required>
            </div>

            <div class="button-container">
                <button type="submit"><span>Save Changes</span></button>
            </div>
        </div>
    </main>

    <script src="/script_java_user_panel/aside_hide_show.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.18.0/firebase-firestore.js"></script>

    <script>
        // Add your Firebase project configuration
        const firebaseConfig = {
        apiKey: "AIzaSyB6LGyoosFP5HwgzqdoJVh797Qhwv8Fzlg",
        authDomain: "ase-storage.firebaseapp.com",
        databaseURL: "https://ase-storage-default-rtdb.firebaseio.com",
        projectId: "ase-storage",
        storageBucket: "ase-storage.appspot.com",
        messagingSenderId: "56574862198",
        appId: "1:56574862198:web:f9063396b80ede2eca5057",
        measurementId: "G-51J6SN1SWR"
};
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', () => {
            const userId = 'USER_ID'; // Replace with the logged-in user's ID

            // Get user data from Firestore
            const userDocRef = db.collection('users').doc(userId);

            userDocRef.get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('name').value = userData.name || '';
                    document.getElementById('email').value = userData.email || '';
                    document.getElementById('phone').value = userData.phone || '';
                    document.getElementById('address').value = userData.address || '';
                } else {
                    console.log('No such document!');
                }
            }).catch(error => {
                console.log('Error getting document:', error);
            });

            // Save changes to Firestore
            document.getElementById('save-btn').addEventListener('click', () => {
                const updatedData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value
                };

                userDocRef.update(updatedData)
                    .then(() => {
                        console.log('Document successfully updated!');
                    })
                    .catch(error => {
                        console.error('Error updating document: ', error);
                    });
            });
        });
    </script>
</body>
</html>
